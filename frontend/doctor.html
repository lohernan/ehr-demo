<!doctype html>
<html>
<head><meta charset="utf-8"><title>Doctor - EHR Demo</title><link rel="stylesheet" href="css/style.css"></head>
<body>

      <div class="top-bar">
    <button class="icon-button" title="Settings" aria-label="Settings">
      <!-- Gear icon -->
      <svg viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="3"></circle>
        <path d="M19.4 15a1.7 1.7 0 0 0 .3 2.3l.3.3a2 2 0 0 1-2.8 2.8l-.3-.3a1.7 1.7 0 0 0-2.3-.3 1.7 1.7 0 0 0-1 0 1.7 1.7 0 0 0-2.3.3l-.3.3a2 2 0 1 1-2.8-2.8l.3-.3a1.7 1.7 0 0 0 0-2.3 1.7 1.7 0 0 0 0-1 1.7 1.7 0 0 0-.3-2.3l-.3-.3a2 2 0 0 1 2.8-2.8l.3.3a1.7 1.7 0 0 0 2.3 0 1.7 1.7 0 0 0 1 0 1.7 1.7 0 0 0 2.3 0l.3-.3a2 2 0 1 1 2.8 2.8l-.3.3a1.7 1.7 0 0 0 0 2.3 1.7 1.7 0 0 0 0 1z"/>
      </svg>
    </button>

    <div style="flex: 1;"></div>

    <button class="icon-button" title="Notifications" aria-label="Notifications">
      <!-- Bell icon -->
      <svg viewBox="0 0 24 24">
        <path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9"></path>
        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
      </svg>
    </button>

    <button class="icon-button" title="Profile" aria-label="Profile">
      <!-- User icon -->
      <svg viewBox="0 0 24 24">
        <circle cx="12" cy="7" r="4"></circle>
        <path d="M5.5 21a7.5 7.5 0 0 1 13 0"></path>
      </svg>
    </button>
  </div>
  
<div class="container">
  <h2>Doctor Dashboard</h2>
  <div>
    <button id="refresh">Load patients</button>
    <div id="patients"></div>
  </div>

  <h3>Prescribe medication</h3>
  <div>
    <select id="patientSelect"></select><br/>
    <input id="drug" placeholder="Drug name"/><br/>
    <input id="dosage" placeholder="Dosage (e.g. 500mg)" /><br/>
    <button id="prescribeBtn">Submit Prescription</button>
    <p id="presMsg"></p>
  </div>
</div>

<script src="js/app.js"></script>
<script>
  async function loadPatients(){
    const list = await listPatients();
    const sel = document.getElementById('patientSelect');
    sel.innerHTML = '';
    list.forEach(p => {
      const opt = document.createElement('option');
      opt.value = p.id;
      opt.text = p.first_name + ' ' + p.last_name;
      sel.appendChild(opt);
    });
  }
  document.getElementById('refresh').addEventListener('click', loadPatients);
  document.getElementById('prescribeBtn').addEventListener('click', async ()=>{
    const patient_id = parseInt(document.getElementById('patientSelect').value);
    const drug = document.getElementById('drug').value;
    const dosage = document.getElementById('dosage').value;
    const user = JSON.parse(localStorage.getItem('user') || '{}');
    const res = await createPrescription({ patient_id, prescribed_by: user.id || 1, drug_name: drug, dosage });
    document.getElementById('presMsg').innerText = res.ok ? 'Prescription created' : 'Error';
  });

  function getQueryParams() {
  return Object.fromEntries(new URLSearchParams(window.location.search));
}

async function selectPatientFromQuery() {
  const params = getQueryParams();
  if (!params.patientId) return;

  const sel = document.getElementById('patientSelect');
  await loadPatients(); // load all patients first

  const option = Array.from(sel.options).find(o => o.value === params.patientId);
  if (option) sel.value = params.patientId;
  if (params.patientName) {
    // Optionally show patient name somewhere
    document.getElementById('presMsg').innerText = `Prescribing for ${params.patientName}`;
  }
}

// Call this after loadPatients
  selectPatientFromQuery();


  // auto-load
  loadPatients();
</script>
</body>
</html>
